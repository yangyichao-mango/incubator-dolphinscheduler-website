<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="development-environment-setup" />
	<meta name="description" content="development-environment-setup" />
	<!-- 网页标签标题 -->
	<title>development-environment-setup</title>
	<link rel="shortcut icon" href="/img/docsite.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/hlogo_colorful.svg"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><div><ul class="ant-menu blackClass ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span class="submenu-title-wrapper">文档</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/docs/release/download.html" target="_self">下载</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="http://106.75.43.194:8888" target="_blank">线上demo</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/blog/index.html" target="_self">博客</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/docs/development/subscribe.html" target="_self">开发者</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/community/index.html" target="_self">社区</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul></div></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>部署文档</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/1.2.1/user_doc/hardware-environment.html" target="_self">软硬件环境建议配置</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/1.2.1/user_doc/standalone-deployment.html" target="_self">单机部署(Standalone)</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/1.2.1/user_doc/cluster-deployment.html" target="_self">集群部署(Cluster)</a></li></ul></li><li class="menu-item menu-item-level-1"><span>用户手册</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/1.2.1/user_doc/quick-start.html" target="_self">快速上手</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/1.2.1/user_doc/system-manual.html" target="_self">用户手册</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/1.2.1/user_doc/metadata-1.2.html" target="_self">元数据文档</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/1.2.1/user_doc/deployparam.html" target="_self">部署参数分析</a></li></ul></li><li class="menu-item menu-item-level-1"><span>API文档</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="http://106.75.43.194:8888/dolphinscheduler/doc.html?language=zh_CN&amp;lang=zh" target="_blank">API文档</a></li></ul></li><li class="menu-item menu-item-level-1"><span>版本升级</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/1.2.1/user_doc/upgrade.html" target="_self">升级</a></li></ul></li><li class="menu-item menu-item-level-1"><span>FAQ</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/release/faq.html" target="_self">FAQ</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h4>准备工作</h4>
<ol>
<li>
<p>首先从远端仓库fork <a href="https://github.com/apache/incubator-dolphinscheduler">dolphinscheduler</a> 一份代码到自己的仓库中</p>
</li>
<li>
<p>安装好MySQL/PostgreSQL,Zookeeper,Nginx,Hadoop(可选)</p>
</li>
<li>
<p>把自己仓库clone到本地</p>
<p><code>git clone https://github.com/apache/incubator-dolphinscheduler.git</code></p>
</li>
<li>
<p>git clone项目后，进入目录，执行以下命令。</p>
</li>
</ol>
<pre><code>1. git branch -a    #查看分支
2. git checkout dev #切换到dev分支
3. git pull #同步分支
4. mvn -U clean package -Prelease -Dmaven.test.skip=true   #由于项目使用了gRPC，所以需要先编译项目生成需要的类。
</code></pre>
<h4>搭建后端</h4>
<ol>
<li>
<p>创建ds数据库CREATE DATABASE dolphinscheduler。</p>
</li>
<li>
<p>创建表和初始化数据：
修改dao模块resource目录下application.properties文件中的数据库配置信息，如果你使用MySQL作为数据库，那么还需要配置pom.xml中mysql-connector-java依赖的scope为compile，然后执行org.apache.dolphinscheduler.dao.upgrade.shell.CreateDolphinScheduler的类，运行完，刷新数据库，表和数据都有了。</p>
</li>
<li>
<p>启动MasterServer
org.apache.dolphinscheduler.server.master.MasterServer类main函数增加如下代码：</p>
<pre><code>System.setProperty(&quot;spring.profiles.active&quot;,&quot;master&quot;);
</code></pre>
<p>修改server模块resources目录下master_logback.xml文件，增加以下代码：</p>
<pre><code>&lt;root level=&quot;INFO&quot;&gt;
 &lt;appender-ref ref=&quot;MASTERLOGFILE&quot;/&gt;
 &lt;!-- 增加日志到控制台--&gt;
 &lt;appender-ref ref=&quot;STDOUT&quot;/&gt;
&lt;/root&gt;
</code></pre>
<p>修改common模块，quartz.properties中数据库配置信息，zookeeper.properties中链接信息(zookeeper.quorum), 然后执行MasterServer即可。</p>
</li>
<li>
<p>启动WorkerServer
org.apache.dolphinscheduler.server.worker.WorkerServer类main函数增加如下代码：</p>
<pre><code>System.setProperty(&quot;spring.profiles.active&quot;,&quot;worker&quot;);
</code></pre>
<p>修改server模块resources目录下worker_logback.xml文件，增加以下代码：</p>
<pre><code>&lt;root level=&quot;INFO&quot;&gt;
 &lt;appender-ref ref=&quot;TASKLOGFILE&quot;/&gt;
 &lt;appender-ref ref=&quot;WORKERLOGFILE&quot;/&gt;
 &lt;!-- 增加日志到控制台--&gt;
 &lt;appender-ref ref=&quot;STDOUT&quot;/&gt;
&lt;/root&gt;
</code></pre>
<p>然后执行MasterServer即可。</p>
</li>
</ol>
<h4>搭建前端</h4>
<p>进入dolphinscheduler-ui的目录，执行ui项目的编译，由于是webpack和vue，所以需要以下命令：</p>
<pre><code>1. npm install    #没有npm的，mac用brew安装。brew install npm。
2. npm run build  #执行完build命令后，会生成dist文件夹，这个文件夹一定要和nginx配置文件的40行所指的目录相同。
</code></pre>
<p>保存以下内容到dolphinscheduler.conf文件：</p>
<pre><code>
#user  nobody;
worker_processes  1;

error_log  /usr/local/etc/nginx/logs/error.log;
error_log  /usr/local/etc/nginx/logs/error.log  notice;
error_log  /usr/local/etc/nginx/logs/error.log  info;

pid        /usr/local/etc/nginx/logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
    #                  '$status $body_bytes_sent &quot;$http_referer&quot; '
    #                  '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

    access_log  /usr/local/etc/nginx/logs/access.log;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;
    server {
        listen       8888;# access port
        server_name  localhost;
        #charset koi8-r;
        access_log  /usr/local/etc/nginx/logs/host.access.log;
        location / {
            root   /xxx/xxx/incubator-dolphinscheduler/dolphinscheduler-ui/dist; #这里为ui目录，需要修改
            index  index.html index.html;
        }
        location /dolphinscheduler {
            proxy_pass http://localhost:12345; # interface address
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header x_real_ipP $remote_addr;
            proxy_set_header remote_addr $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_http_version 1.1;
            proxy_connect_timeout 300s;
            proxy_read_timeout 300s;
            proxy_send_timeout 300s;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection upgrade;
        }
        #error_page  404              /404.html;
        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /usr/share/nginx/html;
        }
    }
    include servers/*;
}

</code></pre>
<p>修改上面root指向，然后将文件放到nginx配置同级目录,使用以下命令，启动nginx。</p>
<pre><code>./nginx -c dolphinscheduler.conf
</code></pre>
<p>启动ApiApplicationServer类：
org.apache.dolphinscheduler.api.ApiApplicationServer类main函数增加如下代码：</p>
<pre><code>System.setProperty(&quot;spring.profiles.active&quot;, &quot;api&quot;);
</code></pre>
<p>修改api模块resources目录下apiserver_logback.xml文件，增加以下代码：</p>
<pre><code>&lt;root level=&quot;INFO&quot;&gt;
 &lt;appender-ref ref=&quot;APISERVERLOGFILE&quot; /&gt;
 &lt;!-- 增加日志到控制台--&gt;
 &lt;appender-ref ref=&quot;STDOUT&quot;/&gt;
&lt;/root&gt;
</code></pre>
<pre><code>执行ApiApplicationServer, 然后访问localhost:8888，账号admin/dolphinscheduler123。
</code></pre>
<h4>资源中心</h4>
<p>ds对于资源的存储在本地文件系统/HDFS/S3/minio中，HDFS的mac安装请参考:<a href="https://www.jianshu.com/p/935b4c5e4c25">https://www.jianshu.com/p/935b4c5e4c25</a>
hdfs下载:<a href="https://www.apache.org/dyn/closer.cgi/hadoop/common/hadoop-2.8.5/hadoop-2.8.5.tar.gz">https://www.apache.org/dyn/closer.cgi/hadoop/common/hadoop-2.8.5/hadoop-2.8.5.tar.gz</a>
安装好hdfs后，修改common.properties配置：</p>
<pre><code>res.upload.startup.type=HDFS
</code></pre>
<p>修改hadoop.properties：</p>
<pre><code>fs.defaultFS=hdfs://localhost:9000
</code></pre>
<p>然后重启ApiApplicationServer即可。</p>
<p>*<code>注意</code>：上传的文件大小，超过1M下，需要添加nginx参数</p>
<pre><code>client_max_body_size    100m;
</code></pre>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/ds_gray.svg"/><div class="cols-container"><div class="col col-12"><h3>Disclaimer</h3><p>Apache DolphinScheduler (incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by Incubator. 
Incubation is required of all newly accepted projects until a further review indicates 
that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. 
While incubation status is not necessarily a reflection of the completeness or stability of the code, 
it does indicate that the project has yet to be fully endorsed by the ASF.</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/1.2.0/user_doc/architecture-design.html" target="_self">概览</a></dd><dd><a href="/zh-cn/docs/1.2.0/user_doc/quick-start.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/1.2.0/user_doc/backend-development.html" target="_self">开发者指南</a></dd></dl></div><div class="col col-6"><dl><dt>ASF</dt><dd><a href="http://www.apache.org" target="_self">基金会</a></dd><dd><a href="http://www.apache.org/licenses/" target="_self">证书</a></dd><dd><a href="http://www.apache.org/events/current-event" target="_self">事件</a></dd><dd><a href="http://www.apache.org/foundation/sponsorship.html" target="_self">赞助</a></dd><dd><a href="http://www.apache.org/foundation/thanks.html" target="_self">致谢</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2018-2019 The Apache Software Foundation. Apache DolphinScheduler, DolphinScheduler, and its feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>